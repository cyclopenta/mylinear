---
title: "tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(qwzLinear)
```
## Introdction  
This package integrates the basic elements in the linear regression based on BIOSTAT650. The main function *mylm* will return a list of 5 items, They are:  
  
**results**: dataframe, with similar format with summary(lm)  
  
**residuals**: The residuals of the model  
  
**R.square**: The R^2 which demonstrate the percentage of variance in Y explained by the model  
  
**R.square.adj**: The adjusted of R^2  
  
**SSE**: The sum of square errors in the model  
  
Also, the function will automatically plot the *partial regression plots* for MLR and residual plot for SLR to test **"linearity"** assumption. $\hat{\epsilon}$ v.s. $\hat{Y}$ is also generated to test **"constant variance"** assumption"  
  
The example dataset named with "mydata" was generated from the reference below:  
  
**Morgenstern, Lewis B., et al. "Fatalism, optimism, spirituality, depressive symptoms, and stroke outcome: a population-based analysis." Stroke 42.12 (2011): 3518-3523.**
  
## Usage
The main fucntion in this package is **mylm** and **categorize**. The details of input could be found by using "help(mylm)" or â€œhelp(categorize)".  
  
**1.Using the internal dataset**  
```{r}
data(mydata)
dim(mydata)
```
  
**2.Basic MLR with/without model diagnose**  
```{r}
covar1 = c('Fatalism', 'Sex', 'R_E', 'Age')
t1 = mylm(mydata, 'Depression', covar1)
# check the result table 
t1$results
# could also fit a model without intercept and deactivate the diagnose function
t2 = mylm(mydata, 'Depression', covar1, intercept = FALSE, model.diag = FALSE)
t2$results
```
  
**3.Categorize variables into dummy variables **  
```{r}
tmp = categorize(mydata, c('R_E', 'NIHSS_4Cat'), ref = c(0,1))
# We get new dummy variables and the original columns were deleted
head(tmp[,52:55])
# We could also use cellmeans coding method 
tmp = categorize(mydata, c('R_E', 'NIHSS_4Cat'), method = 'cellmeans')
head(tmp[,52:56])
```
  
**4.Users could also directly add categorical variables in the mylm funciont**
```{r}
covar2 = c('Fatalism', 'Sex', 'R_E', 'Age_4Cat', 'NIHSS_4Cat')
covar3 = c('Fatalism', 'Sex', 'R_E', 'Age_4Cat')
t4 = mylm(mydata, 'Depression', covar2, category = c('Age_4Cat', 'NIHSS_4Cat'), ref = c(1,1))
t5 = mylm(mydata, 'Depression', covar3, category = c('Age_4Cat'), cat_method = 'cellmeans', intercept = F, model.diag = F)
```
```{r}
# The results for model with categorical variables
t4$results
t5$results
```
  
**5.Users could also add interaction term in the model**
```{r}
t8 = mylm(mydata, 'Depression', covar1, inter = c('Age:Sex','Age:Fatalism'), model.diag = FALSE)
t8$results
```
  
**6.To add interaction with categorical variables, using categorize() first**
```{r}
dat9 = categorize(mydata, c('NIHSS_4Cat', 'Comorbidity1'), ref = c(1,0))
covar5 = c('NIHSS_4Cat.2', 'NIHSS_4Cat.4', 'NIHSS_4Cat.3', 'Comorbidity1.4', 
           'Comorbidity1.3', 'Comorbidity1.6', 'Comorbidity1.5','Comorbidity1.2', 
           'Comorbidity1.1', 'Comorbidity1.7', 'Fatalism', 'Sex', 
           'R_E', 'Age', 'Optimism','HiChol')
t9 = mylm(dat9, 'Depression', covar5, inter = c('Age:Sex','Age:Fatalism','HiChol:Fatalism'), model.diag = FALSE)
t9$results
```
  
**NOTE**  
High order interaction like 3-way interaction is not recommended dut to the hardness of interpretation. The algorithm estimating this kind of case is also out the range of BIOSTAT650.  

## Comparsion and Correctness
  
**1.Correctness**
Correctness is confirmed by passing all the unit tests. The tests are based on the comparing the results to lm() and anova(). Examples are shown below to show the Correctness.  
```{r}

```
